{% extends 'core/layout/_base.html' %}
{% load static %}

{% block title %}Modifications Ontologie ‚Äî TRANSPERSO{% endblock %}

{% block body %}
<div class="hills-decoration"></div>

{% include 'core/partials/_navbar.html' %}

<!-- HERO SECTION -->
<section class="hero" style="min-height: 30vh; padding: 4rem 2rem;">
  <div class="hero-container" style="grid-template-columns: 1fr; text-align: center;">
    <div class="hero-content">
      <h2 style="font-size: 42px; margin-bottom: 1rem;">
        <span class="trans">Modifications</span> <span class="perso">Ontologie</span>
      </h2>
      <p style="font-size: 16px; max-width: 700px; margin: 0 auto 2rem;">
        Modifiez votre ontologie en langage naturel - Ajout, suppression et modification de donn√©es
      </p>
    </div>
  </div>
</section>

<!-- MESSAGES -->
{% if messages %}
  <div style="max-width: 1280px; margin: 2rem auto; padding: 0 2rem;">
    {% for message in messages %}
      <div style="background: #d1fae5; color: #065f46; padding: 1rem 1.5rem; border-radius: 12px; margin-bottom: 1rem; font-weight: 600; box-shadow: var(--shadow-sm);">
        {{ message }}
      </div>
    {% endfor %}
  </div>
{% endif %}

<!-- MAIN CONTENT -->
<section style="max-width: 1280px; margin: 2rem auto; padding: 0 2rem;">
  <div class="grid-2col" style="gap: 2rem; margin-bottom: 3rem;">
    <!-- CARD: MODIFICATIONS -->
    <div class="glass" style="padding: 2rem; border-radius: 20px;">
      <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 1.5rem;">
        <div style="background: linear-gradient(135deg, #f59e0b, #d97706); color: white; width: 40px; height: 40px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 18px;">
          üìù
        </div>
        <h3 style="margin: 0; color: var(--text-primary);">Op√©rations de Modification</h3>
      </div>
      
      <form method="post">
        {% csrf_token %}
        <input type="hidden" name="action" value="update">
        <div style="margin-bottom: 1.5rem;">
          <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary);">
            Votre instruction de modification:
          </label>
          <textarea 
            class="form-input" 
            id="question" 
            name="question" 
            placeholder="Ex: Ajoute une nouvelle station de bus 'Gare Centrale' √† Tunis, Supprime la station soukra, Modifie le nom de la station..." 
            rows="4" 
            required
            style="width: 100%; padding: 1rem; border: 2px solid #e5e7eb; border-radius: 12px; font-family: inherit; font-size: 14px; resize: vertical; background: rgba(255, 255, 255, 0.8);"
          ></textarea>
        </div>
        <button type="submit" class="cta-btn" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
          Ex√©cuter la modification
        </button>
      </form>
    </div>

    <!-- CARD: V√âRIFICATION -->
    <div class="glass" style="padding: 2rem; border-radius: 20px;">
      <div style=" align-items: center; gap: 12px; margin-bottom: 1.5rem;">
        <div style="background: linear-gradient(135deg, #06b6d4, #0891b2); color: white; width: 40px; height: 40px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 18px;">
          üîç
        </div>
        <h3 style="margin: 0; color: var(--text-primary);">V√©rification</h3>
      </div>
      
      <form method="post">
        {% csrf_token %}
        <input type="hidden" name="action" value="query">
        <div style="margin-bottom: 1.5rem;">
          <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary);">
            V√©rifier les donn√©es:
          </label>
          <input 
            type="text" 
            class="form-input" 
            id="question_check" 
            name="question" 
            placeholder="Ex: Affiche les stations, Liste les bus..." 
            style="width: 100%; padding: 1rem; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 14px; background: rgba(255, 255, 255, 0.8);"
          >
        </div>
        <button type="submit" class="cta-btn" style="background: linear-gradient(135deg, #06b6d4, #0891b2);">
          V√©rifier
        </button>
      </form>
    </div>
  </div>

  <!-- SPARQL QUERY -->
  {% if sparql_query %}
  <div class="glass" style="padding: 2rem; border-radius: 20px; margin-bottom: 2rem;">
    <h4 style="margin-bottom: 1rem; color: var(--text-primary);">Requ√™te SPARQL g√©n√©r√©e:</h4>
    <pre style="background: rgba(0, 0, 0, 0.05); padding: 1.5rem; border-radius: 12px; overflow-x: auto; font-size: 13px; line-height: 1.4; margin: 0;"><code>{{ sparql_query }}</code></pre>
  </div>
  {% endif %}

  <!-- RESULTS -->
  {% if update_result %}
    {% if update_result.status == 'success' %}
    <div class="glass" style="padding: 2rem; border-radius: 20px; margin-bottom: 2rem; background: linear-gradient(135deg, #d1fae5, #a7f3d0);">
      <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 1rem;">
        <div style="background: #10b981; color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 16px;">
          ‚úÖ
        </div>
        <h4 style="margin: 0; color: #065f46;">Succ√®s !</h4>
      </div>
      <p style="margin: 0; color: #065f46; font-weight: 600;">{{ update_result.message }}</p>
    </div>
    {% elif update_result.status == 'error' %}
    <div class="glass" style="padding: 2rem; border-radius: 20px; margin-bottom: 2rem; background: linear-gradient(135deg, #fecaca, #fca5a5);">
      <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 1rem;">
        <div style="background: #ef4444; color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 16px;">
          ‚ùå
        </div>
        <h4 style="margin: 0; color: #991b1b;">Erreur</h4>
      </div>
      <p style="margin: 0; color: #991b1b; font-weight: 600;">{{ update_result.message }}</p>
    </div>
    {% elif update_result.status == 'query' %}
    <div class="glass" style="padding: 2rem; border-radius: 20px; margin-bottom: 2rem;">
      <h4 style="margin-bottom: 1rem; color: var(--text-primary);">
        R√©sultats de v√©rification ({{ update_result.count }} trouv√©s):
      </h4>
      {% if update_result.rows %}
      <table>
        <thead class="thead-transport">
          <tr>
            {% for header in update_result.headers %}
            <th>{{ header }}</th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for row in update_result.rows %}
          <tr>
            {% for cell in row %}
            <td>{{ cell }}</td>
            {% endfor %}
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <div style="text-align: center; padding: 2rem; color: var(--text-muted);">
        <p style="font-size: 16px;">Aucun r√©sultat trouv√©.</p>
      </div>
      {% endif %}
    </div>
    {% endif %}
  {% endif %}

  <!-- EXAMPLES SECTION -->
  <div class="glass" style="padding: 2rem; border-radius: 20px;">
    <h4 style="margin-bottom: 1.5rem; color: var(--text-primary);">üí° Exemples d'instructions de modification</h4>
    
    <div class="grid-2col" style="gap: 2rem;">
      <!-- AJOUTS -->
      <div>
        <h5 style="color: #10b981; margin-bottom: 1rem; display: flex; align-items: center; gap: 8px;">
          <span>‚ûï</span> Ajouts
        </h5>
        <ul style="list-style: none; padding: 0; margin: 0;">
          <li style="padding: 0.75rem; background: rgba(16, 185, 129, 0.1); border-radius: 8px; margin-bottom: 0.5rem; font-size: 14px;">
            <strong>"Ajoute une nouvelle station de bus 'Gare Centrale' √† Tunis"</strong>
          </li>
          <li style="padding: 0.75rem; background: rgba(16, 185, 129, 0.1); border-radius: 8px; margin-bottom: 0.5rem; font-size: 14px;">
            <strong>"Cr√©e un nouveau bus ligne 99 avec capacit√© 60"</strong>
          </li>
          <li style="padding: 0.75rem; background: rgba(16, 185, 129, 0.1); border-radius: 8px; margin-bottom: 0.5rem; font-size: 14px;">
            <strong>"Ajoute un nouveau passager Jean Dupont √¢ge 30"</strong>
          </li>
          <li style="padding: 0.75rem; background: rgba(16, 185, 129, 0.1); border-radius: 8px; font-size: 14px;">
            <strong>"Connecte la station Bab El Khadhra √† Ben Arous"</strong>
          </li>
        </ul>
      </div>

      <!-- MODIFICATIONS & SUPPRESSIONS -->
      <div>
        <h5 style="color: #f59e0b; margin-bottom: 1rem; display: flex; align-items: center; gap: 8px;">
          <span>‚úèÔ∏è</span> Modifications
        </h5>
        <ul style="list-style: none; padding: 0; margin: 0 0 1.5rem 0;">
          <li style="padding: 0.75rem; background: rgba(245, 158, 11, 0.1); border-radius: 8px; margin-bottom: 0.5rem; font-size: 14px;">
            <strong>"Modifie le nom de station soukra en 'Nouveau Soukra'"</strong>
          </li>
          <li style="padding: 0.75rem; background: rgba(245, 158, 11, 0.1); border-radius: 8px; margin-bottom: 0.5rem; font-size: 14px;">
            <strong>"Rends la station Ben Arous accessible"</strong>
          </li>
          <li style="padding: 0.75rem; background: rgba(245, 158, 11, 0.1); border-radius: 8px; font-size: 14px;">
            <strong>"Change la capacit√© du bus 23 √† 70"</strong>
          </li>
        </ul>

        <h5 style="color: #ef4444; margin-bottom: 1rem; display: flex; align-items: center; gap: 8px;">
          <span>üóëÔ∏è</span> Suppressions
        </h5>
        <ul style="list-style: none; padding: 0; margin: 0;">
          <li style="padding: 0.75rem; background: rgba(239, 68, 68, 0.1); border-radius: 8px; margin-bottom: 0.5rem; font-size: 14px;">
            <strong>"Supprime la station soukra"</strong>
          </li>
          <li style="padding: 0.75rem; background: rgba(239, 68, 68, 0.1); border-radius: 8px; font-size: 14px;">
            <strong>"Enl√®ve l'accessibilit√© de la station Ben Arous"</strong>
          </li>
        </ul>
      </div>
    </div>
  </div>
</section>

{% include 'core/partials/_footer.html' %}
{% endblock %}